a<-b
}
if(is.null(width)) width=ifelse(contmode,1,0.9)
barwidth=width
df
a
if(is.null(width)) width=0.9
df$xno=as.numeric(factor(df[[1]]))
df$yno=as.numeric(factor(df[[2]]))
total=sum(a)
(csum=colSums(a))
(csum/total)<0.05
(rsum=rowSums(a))
(xmax=cumsum(csum))
(xmin=cumsum(csum)-csum)
(x=(xmax+xmin)/2)
(width=csum*width)
(xmax=x+width/2)
(xmin=x-width/2)
df$xmin=df$xmax=df$x=df$csum=df$width=0
for(i in 1:max(df$xno)){
df[df$xno==i,]$csum=csum[i]
df[df$xno==i,]$xmin=xmin[i]
df[df$xno==i,]$xmax=xmax[i]
df[df$xno==i,]$x=x[i]
df[df$xno==i,]$width=width[i]
}
count=max(df$xno)
if(position=="dodge"){
df$ymax=df$nrow
df$ymin=0
df$y=(df$ymax+df$ymin)/2
ycount=max(df$yno)
df$xmin2=df$xmin+(df$yno-1)*(df$width/ycount)
df$xmax2=df$xmin2+(df$width/ycount)
df$xmin=df$xmin2
df$xmax=df$xmax2
df$x=(df$xmax+df$xmin)/2
df2=df
} else{
for(i in 1:count){
dfsub=df[df$xno==i,]
dfsub$ratio=round(dfsub$nrow*100/csum[i],digits)
dfsub$ymax=cumsum(dfsub$nrow)
dfsub$ymin=dfsub$ymax-dfsub$nrow
if(position=="fill"){
dfsub$ymax=dfsub$ymax*100/csum[i]
dfsub$ymin=dfsub$ymin*100/csum[i]
}
dfsub$y=(dfsub$ymin+dfsub$ymax)/2
if(i==1) df2=dfsub
else df2=rbind(df2,dfsub)
}
}
df2$data_id=as.character(1:nrow(df2))
df2$tooltip=paste0(df2[[xvar]],"<br>",df2[[fillvar]],"<br>",df2$nrow)
df2$label=ifelse((df2$csum/total)>0.04,df2$nrow,"")
if(position!="dodge") {
df2$tooltip=paste0(df2$tooltip,"(",df2$ratio,"%)")
df2$label=ifelse((df2$csum/total)>0.04,paste0(df2$ratio,"%"),"")
}
print(df2)
if(contmode) {
xlabels=breaks[2:length(breaks)]
xlabels
xlabels[csum/total<0.04]=""
} else xlabels=levels(factor(df[[1]]))
ylabels=levels(factor(df[[2]]))
if(contmode) {
ycount=3
(pos=1:ycount)
y=(100/ycount)*(pos-1)+(100/ycount)/2
} else y=df2[df2$xno==1,"y"]
print(df2)
xvar
fillvar
p<-ggplot(mapping=aes_string(x=xvar,fill=fillvar,y="nrow"),data=df2)+
# geom_bar(stat="identity")
# geom_bar_interactive(stat="identity")
geom_bar_interactive(aes(tooltip=tooltip,data_id=data_id),stat="identity",
position=position,width=barwidth,...)
p
# if(contmode) p<-p+scale_x_continuous(breaks=xmax,labels=xlabels,limits = c(0,total))
# else p<-p+scale_x_continuous(breaks=x,labels=xlabels,limits = c(0,total))
#
# if(position!="dodge") {
#     p<-p+ scale_y_continuous(breaks=y,labels=ylabels)+
#         #scale_fill_discrete(guide=FALSE)+
#         scale_fill_brewer(palette=palette,guide=FALSE)+
#         ylab("")
# } else p<-p+ylab("count")+scale_fill_brewer(palette=palette)
if(addlabel) {
if(position=="stack") {
p=p+geom_text(aes(x=df2$xno,y=df2$y,label=df2$label))
} else if(position=="fill") {
p=p+geom_text(aes(x=df2$xno,y=(df2$y)/100,label=df2$label))
} else {
p=p+geom_text(aes(label=df2$label),position=position_dodge(0.9),vjust=1.5)
}
}
# p<-p+theme_bw()+
#     theme(axis.text.y=element_text(angle=90),axis.ticks.y=element_blank())
#
if(polar==TRUE) p<-p+ coord_polar()
if(horizontal==TRUE) p<-p+ coord_flip()
if(yangle!=0) p<-p+theme(axis.text.y=element_text(angle=90,hjust = 0.5))
if(!is.null(palette)) p<-p+scale_fill_brewer(palette=palette)
if(interactive)
p<-ggiraph(code={print(p)},zoom_max=10)
p
}
ggBar(acs,xvar="Dx",fillvar="sex",addlabel=TRUE,interactive=TRUE)
count=max(df$xno)
data=acs;
xvar="Dx";
fillvar="sex";
yvar=NULL;stat="count";position="stack";palette=NULL
width=NULL;digits=1;horizontal=FALSE;yangle=0
addlabel=FALSE;polar=FALSE;interactive=FALSE
contmode=0
print(fillvar)
print(xvar)
contmode=0
if(is.numeric(data[[xvar]])){
if(is.null(width)) width=1
result=num2cut(data[[xvar]])
b=result$x1
breaks=result$breaks
a=table(data[[fillvar]],b)
a
df=reshape2::melt(a)
df=df[c(2,1,3)]
colnames(df)=c(xvar,fillvar,"nrow")
df
contmode=1
} else if((stat=="identity") &(!is.null(yvar))){
df=data[c(xvar,fillvar,yvar)]
colnames(df)[3]="nrow"
myformula=as.formula(paste(fillvar,"~",xvar))
myformula
b=reshape2::dcast(df,myformula,value=nrow)
a=b[,-1]
rownames(a)=b[[1]]
#str(a)
a=as.matrix(a)
} else {
df=ddply(data,c(xvar,fillvar),"nrow")
df
a=table(data[[fillvar]],data[[xvar]])
a
str(a)
# nrow(a)
# b<-a[nrow(a):1,]
# a<-b
}
if(is.null(width)) width=ifelse(contmode,1,0.9)
barwidth=width
df
a
if(is.null(width)) width=0.9
df$xno=as.numeric(factor(df[[1]]))
df$yno=as.numeric(factor(df[[2]]))
total=sum(a)
(csum=colSums(a))
(csum/total)<0.05
(rsum=rowSums(a))
(xmax=cumsum(csum))
(xmin=cumsum(csum)-csum)
(x=(xmax+xmin)/2)
(width=csum*width)
(xmax=x+width/2)
(xmin=x-width/2)
df$xmin=df$xmax=df$x=df$csum=df$width=0
print(df2)
data=acs;
xvar="Dx";
fillvar="sex";
yvar=NULL;stat="count";position="stack";palette=NULL
width=NULL;digits=1;horizontal=FALSE;yangle=0
addlabel=FALSE;polar=FALSE;interactive=FALSE
contmode=0
if(is.numeric(data[[xvar]])){
if(is.null(width)) width=1
result=num2cut(data[[xvar]])
b=result$x1
breaks=result$breaks
a=table(data[[fillvar]],b)
a
df=reshape2::melt(a)
df=df[c(2,1,3)]
colnames(df)=c(xvar,fillvar,"nrow")
df
contmode=1
} else if((stat=="identity") &(!is.null(yvar))){
df=data[c(xvar,fillvar,yvar)]
colnames(df)[3]="nrow"
myformula=as.formula(paste(fillvar,"~",xvar))
myformula
b=reshape2::dcast(df,myformula,value=nrow)
a=b[,-1]
rownames(a)=b[[1]]
#str(a)
a=as.matrix(a)
} else {
df=ddply(data,c(xvar,fillvar),"nrow")
df
a=table(data[[fillvar]],data[[xvar]])
a
str(a)
# nrow(a)
# b<-a[nrow(a):1,]
# a<-b
}
if(is.null(width)) width=ifelse(contmode,1,0.9)
barwidth=width
df
a
if(is.null(width)) width=0.9
df$xno=as.numeric(factor(df[[1]]))
df$yno=as.numeric(factor(df[[2]]))
total=sum(a)
(csum=colSums(a))
(csum/total)<0.05
(rsum=rowSums(a))
(xmax=cumsum(csum))
(xmin=cumsum(csum)-csum)
(x=(xmax+xmin)/2)
(width=csum*width)
(xmax=x+width/2)
(xmin=x-width/2)
df$xmin=df$xmax=df$x=df$csum=df$width=0
for(i in 1:max(df$xno)){
df[df$xno==i,]$csum=csum[i]
df[df$xno==i,]$xmin=xmin[i]
df[df$xno==i,]$xmax=xmax[i]
df[df$xno==i,]$x=x[i]
df[df$xno==i,]$width=width[i]
}
count=max(df$xno)
if(position=="dodge"){
df$ymax=df$nrow
df$ymin=0
df$y=(df$ymax+df$ymin)/2
ycount=max(df$yno)
df$xmin2=df$xmin+(df$yno-1)*(df$width/ycount)
df$xmax2=df$xmin2+(df$width/ycount)
df$xmin=df$xmin2
df$xmax=df$xmax2
df$x=(df$xmax+df$xmin)/2
df2=df
} else{
for(i in 1:count){
dfsub=df[df$xno==i,]
dfsub$ratio=round(dfsub$nrow*100/csum[i],digits)
dfsub$ymax=cumsum(dfsub$nrow)
dfsub$ymin=dfsub$ymax-dfsub$nrow
if(position=="fill"){
dfsub$ymax=dfsub$ymax*100/csum[i]
dfsub$ymin=dfsub$ymin*100/csum[i]
}
dfsub$y=(dfsub$ymin+dfsub$ymax)/2
if(i==1) df2=dfsub
else df2=rbind(df2,dfsub)
}
}
df2$data_id=as.character(1:nrow(df2))
df2$tooltip=paste0(df2[[xvar]],"<br>",df2[[fillvar]],"<br>",df2$nrow)
df2$label=ifelse((df2$csum/total)>0.04,df2$nrow,"")
if(position!="dodge") {
df2$tooltip=paste0(df2$tooltip,"(",df2$ratio,"%)")
df2$label=ifelse((df2$csum/total)>0.04,paste0(df2$ratio,"%"),"")
}
print(df2)
if(contmode) {
xlabels=breaks[2:length(breaks)]
xlabels
xlabels[csum/total<0.04]=""
} else xlabels=levels(factor(df[[1]]))
ylabels=levels(factor(df[[2]]))
if(contmode) {
ycount=3
(pos=1:ycount)
y=(100/ycount)*(pos-1)+(100/ycount)/2
} else y=df2[df2$xno==1,"y"]
print(df2)
xvar
fillvar
p<-ggplot(mapping=aes_string(xmin="xmin",xmax="xmax",ymin="ymin",ymax="ymax",
fill=fillvar),data=df2)+
#p<-ggplot(mapping=aes_string(xmin="xmin",xmax="xmax",ymin="ymin",ymax="ymax",
#                             fill=fillvar,tooltip="tooltip",data_id="data_id"),data=df2)+
#geom_rect_interactive(...)+
geom_rect_interactive(aes(tooltip=tooltip,data_id=data_id),size=size,colour=colour,...)+
xlab(xvar)
p
p<-ggplot(mapping=aes_string(xmin="xmin",xmax="xmax",ymin="ymin",ymax="ymax",
fill=fillvar),data=df2)+
#p<-ggplot(mapping=aes_string(xmin="xmin",xmax="xmax",ymin="ymin",ymax="ymax",
#                             fill=fillvar,tooltip="tooltip",data_id="data_id"),data=df2)+
#geom_rect_interactive(...)+
geom_rect_interactive(aes(tooltip=tooltip,data_id=data_id),size=size,colour=colour)+
xlab(xvar)
p<-ggplot(mapping=aes_string(xmin="xmin",xmax="xmax",ymin="ymin",ymax="ymax",
fill=fillvar),data=df2)+
#p<-ggplot(mapping=aes_string(xmin="xmin",xmax="xmax",ymin="ymin",ymax="ymax",
#                             fill=fillvar,tooltip="tooltip",data_id="data_id"),data=df2)+
#geom_rect_interactive(...)+
geom_rect_interactive(aes(tooltip=tooltip,data_id=data_id),size=0.5,colour=colour)+
xlab(xvar)
colour="black";size=0.2
p<-ggplot(mapping=aes_string(xmin="xmin",xmax="xmax",ymin="ymin",ymax="ymax",
fill=fillvar),data=df2)+
#p<-ggplot(mapping=aes_string(xmin="xmin",xmax="xmax",ymin="ymin",ymax="ymax",
#                             fill=fillvar,tooltip="tooltip",data_id="data_id"),data=df2)+
#geom_rect_interactive(...)+
geom_rect_interactive(aes(tooltip=tooltip,data_id=data_id),size=0.5,colour=colour)+
xlab(xvar)
p
if(addlabel) {
if(position=="stack") {
p=p+geom_text(aes(x=df2$xno,y=df2$y,label=df2$label))
} else if(position=="fill") {
p=p+geom_text(aes(x=df2$xno,y=(df2$y)/100,label=df2$label))
} else {
p=p+geom_text(aes(label=df2$label),position=position_dodge(0.9),vjust=1.5)
}
}
p
addlabel=TRUE;polar=FALSE;interactive=FALSE
if(addlabel) {
if(position=="stack") {
p=p+geom_text(aes(x=df2$xno,y=df2$y,label=df2$label))
} else if(position=="fill") {
p=p+geom_text(aes(x=df2$xno,y=(df2$y)/100,label=df2$label))
} else {
p=p+geom_text(aes(label=df2$label),position=position_dodge(0.9),vjust=1.5)
}
}
p
p<-ggplot(mapping=aes_string(x=xvar,fill=fillvar,y="nrow"),data=df2)+
# geom_bar(stat="identity")
# geom_bar_interactive(stat="identity")
geom_bar_interactive(aes(tooltip=tooltip,data_id=data_id),stat="identity",
position=position,width=barwidth,...)
p
p<-ggplot(mapping=aes_string(x=xvar,fill=fillvar,y="nrow"),data=df2)+
# geom_bar(stat="identity")
# geom_bar_interactive(stat="identity")
geom_bar_interactive(aes(tooltip=tooltip,data_id=data_id),stat="identity",
position=position,width=barwidth)
p
if(addlabel) {
if(position=="stack") {
p=p+geom_text(aes(x=df2$xno,y=df2$y,label=df2$label))
} else if(position=="fill") {
p=p+geom_text(aes(x=df2$xno,y=(df2$y)/100,label=df2$label))
} else {
p=p+geom_text(aes(label=df2$label),position=position_dodge(0.9),vjust=1.5)
}
}
p
i=1
dfsub=df[df$xno==i,]
dfsub
if(position=="dodge"){
df$ymax=df$nrow
df$ymin=0
df$y=(df$ymax+df$ymin)/2
ycount=max(df$yno)
df$xmin2=df$xmin+(df$yno-1)*(df$width/ycount)
df$xmax2=df$xmin2+(df$width/ycount)
df$xmin=df$xmin2
df$xmax=df$xmax2
df$x=(df$xmax+df$xmin)/2
df2=df
} else{
for(i in 1:count){
dfsub=df[df$xno==i,]
dfsub<-dfsub[nrow(dfsub):1,]
dfsub$ratio=round(dfsub$nrow*100/csum[i],digits)
dfsub$ymax=cumsum(dfsub$nrow)
dfsub$ymin=dfsub$ymax-dfsub$nrow
if(position=="fill"){
dfsub$ymax=dfsub$ymax*100/csum[i]
dfsub$ymin=dfsub$ymin*100/csum[i]
}
dfsub$y=(dfsub$ymin+dfsub$ymax)/2
if(i==1) df2=dfsub
else df2=rbind(df2,dfsub)
}
}
df2$data_id=as.character(1:nrow(df2))
df2$tooltip=paste0(df2[[xvar]],"<br>",df2[[fillvar]],"<br>",df2$nrow)
df2$label=ifelse((df2$csum/total)>0.04,df2$nrow,"")
if(position!="dodge") {
df2$tooltip=paste0(df2$tooltip,"(",df2$ratio,"%)")
df2$label=ifelse((df2$csum/total)>0.04,paste0(df2$ratio,"%"),"")
}
print(df2)
if(contmode) {
xlabels=breaks[2:length(breaks)]
xlabels
xlabels[csum/total<0.04]=""
} else xlabels=levels(factor(df[[1]]))
ylabels=levels(factor(df[[2]]))
if(contmode) {
ycount=3
(pos=1:ycount)
y=(100/ycount)*(pos-1)+(100/ycount)/2
} else y=df2[df2$xno==1,"y"]
print(df2)
xvar
fillvar
p<-ggplot(mapping=aes_string(x=xvar,fill=fillvar,y="nrow"),data=df2)+
# geom_bar(stat="identity")
# geom_bar_interactive(stat="identity")
geom_bar_interactive(aes(tooltip=tooltip,data_id=data_id),stat="identity",
position=position,width=barwidth)
p
if(addlabel) {
if(position=="stack") {
p=p+geom_text(aes(x=df2$xno,y=df2$y,label=df2$label))
} else if(position=="fill") {
p=p+geom_text(aes(x=df2$xno,y=(df2$y)/100,label=df2$label))
} else {
p=p+geom_text(aes(label=df2$label),position=position_dodge(0.9),vjust=1.5)
}
}
p
library(moonBook2)
require(moonBook)
require(ggplot2)
require(ggiraph)
ggBar(acs,"Dx","smoking",position="fill",addlabel=TRUE,width=0.5)
ggBar(acs,"Dx","smoking",addlabel=TRUE,width=0.5)
ggBar(acs,"Dx","smoking",addlabel=TRUE,width=0.5,interactive=TRUE)
library(moonBook2)
ggBar(rose,Month,group,"value",stat="identity",polar=TRUE,palette="Reds",width=1,addlabel=TRUE,
color="black",size=0.1,interactive=TRUE)
ggRose(rose,Month,group,"value",addlabel=TRUE,interactive=TRUE)
ggRose(acs,"Dx","smoking",addlabel=TRUE,interactive=TRUE)
ggBar(rose,Month,group,"value",stat="identity",polar=TRUE,palette="Reds",width=1,
color="black",size=0.1,interactive=TRUE)
ggRose(rose,Month,group,"value",interactive=TRUE)
ggBar(acs,"Dx","smoking",addlabel=TRUE,width=0.5,interactive=TRUE)
ggBar(acs,Dx,smoking,addlabel=TRUE,width=0.5,interactive=TRUE)
ggBar(acs,age,Dx)
ggSpine(acs,age,sex)
ggBar(acs,age,sex)
ggBar(acs,age,Dx)
ggBar(acs,age,Dx,colour="black",size=0.2)
ggBar(acs,age,Dx,colour="black",size=0.2,addlabel=TRUE)
ggplot(acs,aes(x=age,fill=Dx))+geom_histogram()
ggBar(acs,age,Dx,colour="black",size=0.2,addlabel=TRUE)
ggBar(acs,age,Dx)
ggBar(acs,age,Dx,order=desc(Dx))
ggBar(acs,age,Dx,order=desc(acs$Dx))
ggBar(acs,sex,Dx,order=desc(acs$Dx))
ggBar(acs,sex,Dx)
ggplot(acs,aes(x=Dx,fill=sex))+geom_bar()
ggplot(acs,aes(x=Dx,fill=sex,order=desc(sex)))+geom_bar()
ggplot(acs,aes(x=Dx,fill=sex,order=asc(sex)))+geom_bar()
desc
ggplot(acs,aes(x=Dx,fill=sex,order=desc(sex)))+geom_bar()
ggplot(acs,aes(x=Dx,fill=sex,order=-desc(sex)))+geom_bar()
ggplot(acs,aes(x=Dx,fill=sex,order=-desc(sex)))+geom_bar()
ggplot(acs,aes(x=Dx,fill=sex,order=order(sex)))+geom_bar()
ggplot(acs,aes(x=Dx,fill=sex,order=order(sex,decreasing=FALSE)))+geom_bar()
ggplot(acs,aes(x=Dx,fill=sex,order=order(sex,decreasing=TRUE)))+geom_bar()
avg_price <- diamonds %>%
group_by(cut, color) %>%
summarise(price = mean(price)) %>%
ungroup() %>%
mutate(price_rel = price - mean(price))
ggplot(avg_price) +
geom_col(aes(x = cut, y = price, fill = color))
avg_price <- diamonds %>%
group_by(cut, color) %>%
summarise(price = mean(price)) %>%
ungroup() %>%
mutate(price_rel = price - mean(price))
require(dplyr)
avg_price <- diamonds %>%
group_by(cut, color) %>%
summarise(price = mean(price)) %>%
ungroup() %>%
mutate(price_rel = price - mean(price))
ggplot(avg_price) +
geom_col(aes(x = cut, y = price, fill = color))
ggplot(avg_price) +
geom_col(aes(x = cut, y = price_rel, fill = color))
ggplot(avg_price) +
geom_bar(aes(x = cut, y = price_rel, fill = color,stat="identity"))
ggplot(avg_price) +
geom_bar(aes(x = cut, y = price_rel, fill = color),stat="identity")
ggBar(avg_price,xvar="cut",yvar="price",fill="color")
ggplot(avg_price) +
geom_col(aes(x = cut, y = price_rel, fill = color))
ggBar(avg_price,xvar="cut",yvar="price",fill="color",stat="identity")
ggBar(avg_price,xvar="cut",yvar="price_rel",fill="color",stat="identity")
ggBar(avg_price,xvar="cut",yvar="price_rel",fill="color",stat="identity",interactive=TRUE)
ggBar(avg_price,xvar="cut",yvar="price_rel",fill="color",stat="identity",interactive=TRUE,addlabel=TRUE)
ggBar(avg_price,xvar="cut",yvar="price_rel",fill="color",stat="identity",interactive=TRUE)
ggBar(avg_price,xvar="cut",yvar="price",fill="color",stat="identity")
ggBar(avg_price,xvar="cut",yvar="price",fill="color",stat="identity",addlabel=TRUE)
ggBar(avg_price,xvar="cut",yvar="price_rel",fill="color",stat="identity",interactive=TRUE)
ggplot(acs,aes(x=Dx,fill=sex))+geom+bar()
ggplot(acs,aes(x=Dx,fill=sex))+geom_bar()
ggplot(acs,aes(x=Dx,fill=fct_rev(sex)))+geom_bar()
ggplot(acs,aes(x=Dx,fill=forcats::fct_rev(sex)))+geom_bar()
install.packages("forcats")
ggplot(acs,aes(x=Dx,fill=forcats::fct_rev(sex)))+geom_bar()
